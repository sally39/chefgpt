<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChefGPT üçΩÔ∏è</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Set theme ASAP and mirror class for legacy CSS -->
  <script>
    (function(){
      const KEY = 'chefgpt-theme';
      try {
        const saved = localStorage.getItem(KEY);
        const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
        const mode = saved || (prefersLight ? 'light' : 'dark');
        document.documentElement.setAttribute('data-theme', mode);
        // Keep a flag to sync body class once it exists
        window.__CHEFGPT_INITIAL_THEME__ = mode;
      } catch(_) {
        document.documentElement.setAttribute('data-theme', 'dark');
        window.__CHEFGPT_INITIAL_THEME__ = 'dark';
      }
    })();
  </script>

  <style>
    /* Base (dark) design tokens */
    :root{
      --bg: #0b1020;
      --bg-soft: #10162b;
      --card: rgba(255, 255, 255, 0.08);
      --card-border: rgba(255, 255, 255, 0.14);
      --text: #e6e9f2;
      --muted: #b7bfd1;
      --accent: #7dd3fc;
      --accent-2: #a78bfa;
      --success: #34d399;
      --danger: #fb7185;
      --shadow: 0 20px 40px rgba(0,0,0,0.35);
      --btn-bg: var(--card);
      --btn-text: var(--text);
    }

    /* Light overrides via attribute on <html> */
    :root[data-theme='light']{
      --bg: #f8fafc;
      --bg-soft: #ffffff;
      --card: rgba(255,255,255,0.9);
      --card-border: rgba(15, 23, 42, 0.08);
      --text: #0f172a;
      --muted: #475569;
      --btn-bg: rgba(15, 23, 42, 0.06);
      --btn-text: #0f172a;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(125, 211, 252, 0.12), transparent),
                  radial-gradient(1200px 800px at 100% 10%, rgba(167, 139, 250, 0.12), transparent),
                  linear-gradient(180deg, #0b1020 0%, #0e1430 100%);
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100vh;
      transition: background .3s ease, color .3s ease;
    }
    :root[data-theme='light'] body{
      background: radial-gradient(1200px 800px at 20% -10%, rgba(3, 105, 161, 0.08), transparent),
                  radial-gradient(1200px 800px at 100% 10%, rgba(124, 58, 237, 0.08), transparent),
                  linear-gradient(180deg, #f6f9ff 0%, #ffffff 100%);
    }

    /* Header */
    .topbar { display:flex; align-items:center; justify-content:space-between; padding:1rem 1.25rem; gap:.75rem; }
    .brand { display:flex; align-items:center; gap:.75rem; text-decoration:none; color:inherit; }
    .logo { width:40px; height:40px; display:grid; place-items:center; font-size:20px; border-radius:12px; background: linear-gradient(135deg, rgba(125, 211, 252, .25), rgba(167, 139, 250, .25)); border:1px solid var(--card-border); box-shadow: var(--shadow); }
    .title { margin:0; font-size: clamp(1.1rem, 1.5vw + .8rem, 1.5rem); font-weight:700; letter-spacing:.2px; }

    /* Theme toggle */
    #dark-mode-toggle{ border:1px solid var(--card-border); background: var(--btn-bg); color: var(--btn-text); padding:.55rem .7rem; border-radius:12px; cursor:pointer; backdrop-filter: blur(8px); transition: transform .08s ease, filter .2s ease, background .2s ease; }
    #dark-mode-toggle:hover { filter: brightness(1.08); }
    #dark-mode-toggle:active { transform: translateY(1px) scale(0.99); }

    /* Main */
    main { display:grid; place-items:center; padding:.5rem 1rem 2rem; }
    .card { width:min(860px, 96vw); background: var(--card); border:1px solid var(--card-border); border-radius:18px; box-shadow: var(--shadow); padding: clamp(1rem, 1.5vw + 1rem, 2rem); backdrop-filter: blur(10px); position:relative; overflow:hidden; }
    .card::before{ content:""; position:absolute; inset:-1px; background: radial-gradient(500px 200px at 20% -20%, rgba(125,211,252,.12), transparent 70%), radial-gradient(600px 250px at 120% 0%, rgba(167,139,250,.10), transparent 70%); z-index:0; }
    .card-content{ position:relative; z-index:1; }
    .hero { text-align:center; margin-bottom:1.25rem; }
    .hero h2 { margin:0 0 .5rem 0; font-size: clamp(1.6rem, 2.3vw + 1rem, 2.4rem); line-height:1.1; }
    .hero p { color: var(--muted); margin:0; font-size:.98rem; }

    /* Form */
    .form { display:grid; grid-template-columns: 1fr auto; gap:.6rem; margin-top:1rem; }
    .input { width:100%; padding:.9rem 1rem; border-radius:12px; background: rgba(255,255,255,.06); border:1px solid var(--card-border); color: var(--text); outline:none; font-size:1rem; }
    :root[data-theme='light'] .input { background: rgba(15,23,42,.06); }
    .input::placeholder{ color:#94a3b8; }
    .btn{ padding:.9rem 1.1rem; border-radius:12px; border:1px solid transparent; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b1020; font-weight:700; cursor:pointer; transition: transform .06s ease, filter .2s ease, box-shadow .2s ease; box-shadow: 0 8px 20px rgba(125, 211, 252, .25); white-space:nowrap; }
    .btn:hover{ filter: brightness(1.05); }
    .btn:active{ transform: translateY(1px) scale(0.99); }

    /* Chips */
    .chips{ display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.75rem; }
    .chip{ border:1px solid var(--card-border); background: rgba(255,255,255,.06); padding:.45rem .75rem; border-radius:999px; font-size:.9rem; color: var(--muted); cursor:pointer; transition: background .2s ease, color .2s ease; }
    .chip:hover{ background: rgba(255,255,255,.12); color: var(--text); }
    :root[data-theme='light'] .chip{ background: rgba(15,23,42,.06); }

    /* Loading */
    #loading{ display:none; margin:.9rem 0 0; color: var(--muted); font-size:.95rem; }
    .spinner{ display:inline-block; width:1em; height:1em; border-radius:50%; border:.18em solid rgba(255,255,255,.25); border-top-color: var(--accent); animation: spin 1s linear infinite; vertical-align:-3px; margin-right:.5rem; }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* Output */
    .output-wrapper{ display:none; margin-top:1.2rem; border:1px solid var(--card-border); background: rgba(255,255,255,.04); border-radius:14px; overflow:hidden; }
    .output-actions{ display:flex; justify-content:space-between; align-items:center; gap:.5rem; padding:.6rem .75rem; border-bottom:1px solid var(--card-border); background: rgba(255,255,255,.03); }
    .copy-btn{ border:1px solid var(--card-border); background: var(--btn-bg); color: var(--btn-text); padding:.45rem .7rem; border-radius:10px; cursor:pointer; }
    .output-box{ padding:1rem; line-height:1.6; }

    /* Footer */
    footer{ color: var(--muted); font-size:.9rem; padding:1.25rem; text-align:center; }
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="topbar">
    <a class="brand" href="#" aria-label="ChefGPT Home">
      <div class="logo" aria-hidden="true">üçΩÔ∏è</div>
      <h1 class="title">ChefGPT</h1>
    </a>
    <button id="dark-mode-toggle" aria-label="Toggle theme" title="Toggle theme">üåô</button>
  </header>

  <main>
    <section class="card" role="region" aria-labelledby="hero-heading">
      <div class="card-content">
        <div class="hero">
          <h2 id="hero-heading">Turn ingredients into magic</h2>
          <p>Type a few ingredients or a craving. I‚Äôll build a tasty, step‚Äëby‚Äëstep recipe.</p>
        </div>

        <!-- Prompt form -->
        <form id="prompt-form" class="form" autocomplete="off">
          <input type="text" id="user-prompt" class="input" placeholder="e.g. chicken, spinach, lemon ‚Äî quick & healthy" aria-label="Ingredients or idea" required />
          <button type="submit" class="btn">Get Recipe</button>
        </form>

        <!-- Suggested quick chips -->
        <div class="chips" id="suggested-chips" aria-label="Suggested prompts">
          <button class="chip" type="button">pasta, cherry tomatoes, basil</button>
          <button class="chip" type="button">tofu, broccoli, sesame</button>
          <button class="chip" type="button">eggs, mushrooms, 15 minutes</button>
          <button class="chip" type="button">vegan taco night</button>
        </div>

        <!-- Loading indicator -->
        <div id="loading"><span class="spinner"></span>Generating recipe‚Ä¶</div>

        <!-- Output section -->
        <div class="output-wrapper" id="recipe-output-container" aria-live="polite">
          <div class="output-actions">
            <strong>Recipe</strong>
            <button id="copy-button" class="copy-btn">üìã Copy</button>
          </div>
          <div id="recipe-output" class="output-box"></div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <span>Made with ‚ù§Ô∏è for home cooks. Tip: add time/diet like ‚Äú30 minutes, gluten‚Äëfree‚Äù.</span>
  </footer>

  <script>
    const form = document.getElementById("prompt-form");
    const promptInput = document.getElementById("user-prompt");
    const output = document.getElementById("recipe-output");
    const outputContainer = document.getElementById("recipe-output-container");
    const loading = document.getElementById("loading");
    const copyButton = document.getElementById("copy-button");
    const darkToggle = document.getElementById("dark-mode-toggle");

    // Chips autofill
    document.getElementById('suggested-chips').addEventListener('click', (e) => {
      const chip = e.target.closest('.chip');
      if(!chip) return;
      promptInput.value = chip.textContent.trim();
      promptInput.focus();
    });

    // Submit form
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const prompt = promptInput.value.trim();
      if(!prompt) return;

      output.innerHTML = "";
      outputContainer.style.display = "none";
      loading.style.display = "block";

      try {
        const response = await fetch("/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt }),
        });

        const data = await response.json();
        loading.style.display = "none";

        if (data.recipe) {
          output.innerHTML = data.recipe;
          outputContainer.style.display = "block";
        } else {
          output.innerHTML = "‚ùå Error generating recipe.";
          outputContainer.style.display = "block";
        }
      } catch(err){
        loading.style.display = "none";
        output.innerHTML = "‚ùå Network error. Please try again.";
        outputContainer.style.display = "block";
      }
    });

    // Copy to clipboard
    copyButton.addEventListener("click", () => {
      const text = output.innerText || output.textContent || '';
      navigator.clipboard.writeText(text).then(() => {
        copyButton.innerText = "‚úÖ Copied!";
        setTimeout(() => { copyButton.innerText = "üìã Copy"; }, 1500);
      });
    });

    // ===== Theme toggle (attribute + legacy body class) =====
    const KEY = 'chefgpt-theme';

    function currentTheme(){
      return document.documentElement.getAttribute('data-theme') || 'dark';
    }

    function applyTheme(mode){
      document.documentElement.setAttribute('data-theme', mode);
      // Mirror to body class for any external CSS that relies on .light
      document.body.classList.toggle('light', mode === 'light');
      // Icon shows the ACTION: what you'll switch to on next click
      darkToggle.textContent = mode === 'light' ? 'üåô' : 'üåû';
    }

    // On load: sync body class with the early-applied theme
    applyTheme(window.__CHEFGPT_INITIAL_THEME__ || currentTheme());

    darkToggle.addEventListener('click', () => {
      const next = currentTheme() === 'light' ? 'dark' : 'light';
      localStorage.setItem(KEY, next);
      applyTheme(next);
    });
  </script>
</body>
</html>